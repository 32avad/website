<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆ‘çš„ç§äººèµ„æºç«™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .active-tab { background-color: #db2777; color: white; border-color: #db2777; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #111827; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }
        /* é¼ æ ‡æ‚¬åœåœ¨å›¾ç‰‡ä¸Šæ—¶æ˜¾ç¤ºæ‰‹å‹ */
        .cursor-zoom-in { cursor: zoom-in; }
    </style>
</head>
<body class="bg-gray-900 text-white font-sans h-screen flex flex-col overflow-hidden">

    <!-- é¡¶éƒ¨ -->
    <header class="h-16 border-b border-gray-800 flex justify-between items-center px-6 bg-gray-900 shrink-0 z-20">
        <h1 class="text-2xl font-bold text-pink-500 tracking-wider">RESOURCE STORE</h1>
        <button onclick="toggleAdmin()" class="text-xs text-gray-600 hover:text-gray-400">Admin</button>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- å·¦ä¾§ä¾§è¾¹æ  -->
        <aside class="w-48 bg-gray-800 border-r border-gray-700 flex flex-col items-center py-8 space-y-6 shrink-0 z-10">
            <button onclick="filterBy('photo')" id="btn-photo" class="active-tab w-32 py-3 border-2 border-pink-500 rounded text-lg font-bold hover:bg-pink-600/20 transition duration-300">å†™çœŸ</button>
            <button onclick="filterBy('video')" id="btn-video" class="w-32 py-3 border-2 border-pink-500 rounded text-lg font-bold hover:bg-pink-600/20 transition duration-300">è§†é¢‘</button>
            <button onclick="filterBy('comic')" id="btn-comic" class="w-32 py-3 border-2 border-pink-500 rounded text-lg font-bold hover:bg-pink-600/20 transition duration-300">æ¼«ç”»</button>
            <button onclick="filterBy('all')" id="btn-all" class="mt-auto text-sm text-gray-500 hover:text-white">æ˜¾ç¤ºå…¨éƒ¨</button>
        </aside>

        <!-- å³ä¾§ä¸»å†…å®¹åŒº -->
        <main class="flex-1 overflow-y-auto relative p-8">
            <div class="text-center mb-10">
                <h2 class="text-2xl font-bold mb-2">é€‰è´­æµç¨‹</h2>
                <p class="text-gray-400 text-sm">1. æµè§ˆå•†å“ &nbsp;â†’&nbsp; 2. ç‚¹å‡»å›¾ç‰‡æ”¾å¤§æŸ¥çœ‹ &nbsp;â†’&nbsp; 3. æˆªå›¾å‘ç»™æˆ‘ç§èŠ</p>
            </div>

            <!-- å•†å“ç½‘æ ¼ -->
            <div id="product-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 pb-20">
                <!-- JSç”Ÿæˆå†…å®¹ -->
            </div>
        </main>
    </div>

    <!-- ================= å…¨å±å›¾ç‰‡é¢„è§ˆ (æ–°å¢åŠŸèƒ½) ================= -->
    <div id="preview-modal" onclick="closePreview()" class="hidden fixed inset-0 z-[100] bg-black/95 flex items-center justify-center cursor-zoom-out backdrop-blur-sm">
        <!-- å›¾ç‰‡å®¹å™¨ -->
        <div class="relative max-w-[95vw] max-h-[95vh]">
            <img id="preview-img" src="" class="max-w-full max-h-[90vh] object-contain shadow-2xl rounded-md border border-gray-700">
            <p class="text-center text-gray-500 mt-4">ç‚¹å‡»ä»»æ„å¤„å…³é—­é¢„è§ˆ</p>
        </div>
    </div>

    <!-- ================= ç®¡ç†å‘˜åå° ================= -->
    <div id="admin-panel" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4">
        <div class="bg-gray-800 p-6 rounded-lg w-full max-w-2xl border border-pink-500 relative">
            <button onclick="document.getElementById('admin-panel').classList.add('hidden')" class="absolute top-4 right-4 text-gray-400 hover:text-white">âœ• å…³é—­</button>
            <h2 class="text-xl font-bold text-pink-500 mb-4">ğŸ”§ æ·»åŠ æ–°èµ„æº</h2>
            <div class="grid grid-cols-2 gap-4">
                <div class="col-span-2">
                    <label class="text-xs text-gray-400">é€‰æ‹©åˆ†ç±»</label>
                    <div class="flex gap-4 mt-1">
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cat" value="photo" checked> å†™çœŸ</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cat" value="video"> è§†é¢‘</label>
                        <label class="flex items-center gap-2 cursor-pointer"><input type="radio" name="cat" value="comic"> æ¼«ç”»</label>
                    </div>
                </div>
                <input type="text" id="in-title" placeholder="æ ‡é¢˜" class="bg-gray-700 p-2 rounded text-white w-full">
                <input type="text" id="in-price" placeholder="ä»·æ ¼" class="bg-gray-700 p-2 rounded text-white w-full">
                <input type="text" id="in-desc" placeholder="æè¿°" class="bg-gray-700 p-2 rounded text-white w-full">
                <input type="text" id="in-img" placeholder="å›¾ç‰‡é“¾æ¥ (rawé“¾æ¥)" class="bg-gray-700 p-2 rounded text-white w-full col-span-2">
            </div>
            <div class="mt-6 flex gap-4 border-t border-gray-700 pt-4">
                <button onclick="addItem()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-2 rounded font-bold w-1/3">1. æ·»åŠ é¢„è§ˆ</button>
                <div class="flex-1 text-right">
                    <button onclick="exportData()" class="bg-pink-600 hover:bg-pink-700 text-white px-6 py-2 rounded font-bold animate-pulse">2. ç”Ÿæˆä¿å­˜ä»£ç !</button>
                </div>
            </div>
            <div id="export-box" class="hidden mt-4">
                <p class="text-yellow-400 text-xs mb-1">â¬‡ï¸ å…¨é€‰å¤åˆ¶ä¸‹é¢æ‰€æœ‰ä»£ç ï¼Œè¦†ç›– data.js æ–‡ä»¶ï¼Œç„¶åä¿å­˜åˆ·æ–°ï¼</p>
                <textarea id="export-code" class="w-full h-24 bg-black text-green-400 text-xs p-2 rounded"></textarea>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥æ•°æ®æ–‡ä»¶ -->
    <script src="./data.js"></script>

    <script>
        let currentCategory = 'photo'; 

        window.onload = function() {
            if (typeof products === 'undefined') window.products = [];
            filterBy('photo'); 
        }

        // æ‰“å¼€é¢„è§ˆå¤§å›¾
        function openPreview(url) {
            const modal = document.getElementById('preview-modal');
            const img = document.getElementById('preview-img');
            img.src = url;
            modal.classList.remove('hidden');
        }

        // å…³é—­é¢„è§ˆ
        function closePreview() {
            document.getElementById('preview-modal').classList.add('hidden');
            // æ¸…ç©ºsrcé˜²æ­¢å…³é—­åè¿˜åœ¨åŠ è½½
            setTimeout(() => { document.getElementById('preview-img').src = ''; }, 200);
        }

        function filterBy(category) {
            currentCategory = category;
            document.querySelectorAll('aside button').forEach(btn => btn.classList.remove('active-tab'));
            document.getElementById('btn-' + category).classList.add('active-tab');

            const grid = document.getElementById('product-grid');
            grid.innerHTML = "";

            const filtered = category === 'all' ? products : products.filter(item => item.category === category);

            if (filtered.length === 0) {
                grid.innerHTML = `<div class="col-span-full text-center py-20 text-gray-500">æ­¤åˆ†ç±»ä¸‹æš‚æ— å•†å“<br>è¯·ç‚¹å‡» Admin æ·»åŠ </div>`;
                return;
            }

            filtered.forEach((item, index) => {
                const realIndex = products.indexOf(item);
                
                // ä¿®æ”¹è¯´æ˜ï¼š
                // 1. h-64: é«˜åº¦å¢åŠ ï¼Œè®©é•¿å›¾æ˜¾ç¤ºæ›´å¤š
                // 2. object-contain: ä¿è¯å›¾ç‰‡å®Œæ•´æ˜¾ç¤ºï¼Œä¸è£åˆ‡
                // 3. bg-black: ç©ºç™½åŒºåŸŸå¡«é»‘ï¼Œæ˜¾å¾—é«˜çº§
                // 4. onclick: ç‚¹å‡»å›¾ç‰‡è§¦å‘ openPreview
                
                const card = `
                <div class="bg-gray-800 rounded border border-gray-700 overflow-hidden hover:border-pink-500 transition group relative flex flex-col">
                    <div class="h-64 bg-black relative w-full cursor-zoom-in group-hover:opacity-90 transition" onclick="openPreview('${item.img}')">
                        <img src="${item.img}" class="w-full h-full object-contain" 
                             onerror="this.src='https://via.placeholder.com/400?text=Error'">
                        <div class="absolute top-2 right-2 bg-black/60 text-xs px-2 py-1 rounded text-white backdrop-blur-sm border border-gray-600">
                            ğŸ” ç‚¹å‡»æ”¾å¤§
                        </div>
                    </div>
                    <div class="p-4 flex flex-col flex-1">
                        <h3 class="font-bold text-white truncate text-lg">${item.title}</h3>
                        <p class="text-xs text-gray-400 mb-3 h-8 overflow-hidden">${item.desc}</p>
                        <div class="mt-auto flex justify-between items-center pt-2 border-t border-gray-700">
                            <span class="text-2xl font-bold text-pink-500">Â¥${item.price}</span>
                        </div>
                        <button onclick="deleteItem(${realIndex})" class="admin-only hidden absolute top-2 left-2 bg-red-600 text-white text-xs px-2 py-1 rounded z-10 hover:bg-red-700">åˆ é™¤</button>
                    </div>
                </div>`;
                grid.innerHTML += card;
            });

            if(sessionStorage.getItem('isAdmin')) {
                document.querySelectorAll('.admin-only').forEach(el => el.classList.remove('hidden'));
            }
        }

        function toggleAdmin() {
            if(sessionStorage.getItem('isAdmin')) {
                document.getElementById('admin-panel').classList.remove('hidden');
                return;
            }
            const pwd = prompt("è¯·è¾“å…¥å¯†ç :");
            if (pwd === '8888') { 
                sessionStorage.setItem('isAdmin', 'true');
                document.getElementById('admin-panel').classList.remove('hidden');
                filterBy(currentCategory); 
            }
        }

        function addItem() {
            const cat = document.querySelector('input[name="cat"]:checked').value;
            const title = document.getElementById('in-title').value;
            const price = document.getElementById('in-price').value;
            const desc = document.getElementById('in-desc').value;
            const img = document.getElementById('in-img').value;

            if (!title || !img) { alert("æ ‡é¢˜å’Œå›¾ç‰‡å¿…å¡«"); return; }
            products.unshift({ category: cat, title, price, desc, img });
            alert("é¢„è§ˆå·²æ·»åŠ ï¼\n\nè¯·åŠ¡å¿…ç‚¹å‡»ã€2. ç”Ÿæˆä¿å­˜ä»£ç ã€‘ï¼Œ\nå¦åˆ™åˆ·æ–°é¡µé¢åæ•°æ®ä¼šæ¶ˆå¤±ï¼");
            filterBy(cat); 
        }

        function deleteItem(index) {
            if(confirm("ç¡®å®šåˆ é™¤å—ï¼Ÿåˆ é™¤åè®°å¾—ç‚¹å‡»Adminé‡Œçš„ç”Ÿæˆä»£ç ä¿å­˜ï¼")) {
                products.splice(index, 1);
                filterBy(currentCategory);
                document.getElementById('admin-panel').classList.remove('hidden');
                exportData(); 
            }
        }

        function exportData() {
            const code = `const products = ${JSON.stringify(products, null, 4)};`;
            document.getElementById('export-box').classList.remove('hidden');
            document.getElementById('export-code').value = code;
            document.getElementById('export-code').select();
            document.execCommand('copy');
            alert("âœ… ä»£ç å·²å¤åˆ¶ï¼è¯·è¦†ç›– data.js æ–‡ä»¶å¹¶ä¿å­˜ã€‚");
        }
    </script>
</body>
</html>
